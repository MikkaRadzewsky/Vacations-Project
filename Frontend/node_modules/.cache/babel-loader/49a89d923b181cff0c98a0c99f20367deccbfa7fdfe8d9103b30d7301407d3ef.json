{"ast":null,"code":"import _regeneratorRuntime from\"/Users/raniradzewsky/Library/Mobile Documents/com~apple~CloudDocs/Documents/school/John Bryce/John Bryce Projects/Project 3/Vacations Project 5.0/Frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/raniradzewsky/Library/Mobile Documents/com~apple~CloudDocs/Documents/school/John Bryce/John Bryce Projects/Project 3/Vacations Project 5.0/Frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/Users/raniradzewsky/Library/Mobile Documents/com~apple~CloudDocs/Documents/school/John Bryce/John Bryce Projects/Project 3/Vacations Project 5.0/Frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/raniradzewsky/Library/Mobile Documents/com~apple~CloudDocs/Documents/school/John Bryce/John Bryce Projects/Project 3/Vacations Project 5.0/Frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import axios from'axios';import{Config}from'../Utils/Config';import{AuthActionType,authStore}from'../Redux/AuthState';import jwtDecode from\"jwt-decode\";var AuthService=/*#__PURE__*/function(){function AuthService(){_classCallCheck(this,AuthService);}_createClass(AuthService,[{key:\"register\",value:function(){var _register=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(user){var response,token;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.post(Config.serverUrl+\"/api/register/\",user);case 2:response=_context.sent;token=response.data;authStore.dispatch({type:AuthActionType.Register,payload:token});case 5:case\"end\":return _context.stop();}}},_callee);}));function register(_x){return _register.apply(this,arguments);}return register;}()},{key:\"login\",value:function(){var _login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(credentials){var response,token;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.post(Config.serverUrl+\"/api/login/\",credentials);case 2:response=_context2.sent;token=response.data;authStore.dispatch({type:AuthActionType.Login,payload:token});case 5:case\"end\":return _context2.stop();}}},_callee2);}));function login(_x2){return _login.apply(this,arguments);}return login;}()},{key:\"logout\",value:function logout(){authStore.dispatch({type:AuthActionType.Logout});}},{key:\"isLoggedIn\",value:function isLoggedIn(){return authStore.getState().token!==null;}},{key:\"getOneUser\",value:function(){var _getOneUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(id){var response,user;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.get(Config.serverUrl+\"/api/users/\"+id);case 2:response=_context3.sent;user=response.data;return _context3.abrupt(\"return\",user);case 5:case\"end\":return _context3.stop();}}},_callee3);}));function getOneUser(_x3){return _getOneUser.apply(this,arguments);}return getOneUser;}()},{key:\"getUserIdFromToken\",value:function(){var _getUserIdFromToken=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var token,decodedToken,userId;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:token=authStore.getState().token;if(token){_context4.next=3;break;}return _context4.abrupt(\"return\",0);case 3:;_context4.next=6;return jwtDecode(token);case 6:decodedToken=_context4.sent;userId=Promise.resolve(decodedToken.user.userId);return _context4.abrupt(\"return\",userId);case 9:case\"end\":return _context4.stop();}}},_callee4);}));function getUserIdFromToken(){return _getUserIdFromToken.apply(this,arguments);}return getUserIdFromToken;}()},{key:\"isAdmin\",value:function(){var _isAdmin=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){var userId,user,role;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return this.getUserIdFromToken();case 2:userId=_context5.sent;if(!(userId===0)){_context5.next=5;break;}return _context5.abrupt(\"return\",false);case 5:user=this.getOneUser(userId);_context5.next=8;return user;case 8:role=_context5.sent.role;if(!(role===\"Admin\")){_context5.next=11;break;}return _context5.abrupt(\"return\",true);case 11:return _context5.abrupt(\"return\",false);case 12:case\"end\":return _context5.stop();}}},_callee5,this);}));function isAdmin(){return _isAdmin.apply(this,arguments);}return isAdmin;}()}]);return AuthService;}();var authService=new AuthService();export default authService;","map":{"version":3,"names":["axios","Config","AuthActionType","authStore","jwtDecode","AuthService","user","post","serverUrl","response","token","data","dispatch","type","Register","payload","credentials","Login","Logout","getState","id","get","decodedToken","userId","Promise","resolve","getUserIdFromToken","getOneUser","role","authService"],"sources":["/Users/raniradzewsky/Library/Mobile Documents/com~apple~CloudDocs/Documents/school/John Bryce/John Bryce Projects/Project 3/Vacations Project 5.0/Frontend/src/Services/AuthService.ts"],"sourcesContent":["import axios from 'axios';\r\nimport {Config} from '../Utils/Config';\r\nimport { AuthActionType, authStore } from '../Redux/AuthState';\r\nimport UserModel from \"../Models/UserModel\";\r\nimport CredentialsModel from '../Models/CredentialsModel';\r\nimport jwtDecode from \"jwt-decode\";\r\nimport { resolve } from 'path';\r\n\r\nclass AuthService {\r\n\r\n    public async register(user: UserModel): Promise<void> {\r\n        \r\n        const response = await axios.post<string>(Config.serverUrl+\"/api/register/\", user);\r\n\r\n        const token = response.data;\r\n        authStore.dispatch({ type: AuthActionType.Register, payload: token });\r\n    }\r\n\r\n    public async login(credentials: CredentialsModel): Promise<void> {\r\n        const response = await axios.post<string>(Config.serverUrl+\"/api/login/\", credentials);\r\n        const token = response.data;\r\n        authStore.dispatch({ type: AuthActionType.Login, payload: token });\r\n    }\r\n\r\n    public logout(): void {\r\n        authStore.dispatch({ type: AuthActionType.Logout });\r\n    }\r\n\r\n    public isLoggedIn(): boolean {\r\n        return authStore.getState().token !== null;\r\n    }\r\n\r\n    public async getOneUser(id: number): Promise<UserModel> {\r\n        const response = await axios.get<UserModel>(Config.serverUrl+\"/api/users/\"+ id);\r\n        const user = response.data;\r\n        return user;\r\n    }\r\n\r\n\r\n    public async getUserIdFromToken(): Promise<number>{\r\n        const token = authStore.getState().token;\r\n        if(!token){return 0};\r\n        const decodedToken = await jwtDecode(token);\r\n        const userId = Promise.resolve((decodedToken as any).user.userId);\r\n        return userId;\r\n    }\r\n\r\n    public async isAdmin(): Promise<boolean>{    \r\n        const userId = await this.getUserIdFromToken();\r\n\r\n        if(userId===0) return false;\r\n        const user = this.getOneUser(userId);\r\n        const role = (await user).role;\r\n        if(role===\"Admin\") return true;\r\n        return false;\r\n    }\r\n\r\n}\r\n\r\nconst authService = new AuthService();\r\n\r\nexport default authService;"],"mappings":"88BAAA,MAAOA,MAAK,KAAM,OAAO,CACzB,OAAQC,MAAM,KAAO,iBAAiB,CACtC,OAASC,cAAc,CAAEC,SAAS,KAAQ,oBAAoB,CAG9D,MAAOC,UAAS,KAAM,YAAY,CAAC,GAG7BC,YAAW,sNAEb,iBAAsBC,IAAe,6JAEVN,MAAK,CAACO,IAAI,CAASN,MAAM,CAACO,SAAS,CAAC,gBAAgB,CAAEF,IAAI,CAAC,QAA5EG,QAAQ,eAERC,KAAK,CAAGD,QAAQ,CAACE,IAAI,CAC3BR,SAAS,CAACS,QAAQ,CAAC,CAAEC,IAAI,CAAEX,cAAc,CAACY,QAAQ,CAAEC,OAAO,CAAEL,KAAM,CAAC,CAAC,CAAC,sDACzE,yLAED,kBAAmBM,WAA6B,kKACrBhB,MAAK,CAACO,IAAI,CAASN,MAAM,CAACO,SAAS,CAAC,aAAa,CAAEQ,WAAW,CAAC,QAAhFP,QAAQ,gBACRC,KAAK,CAAGD,QAAQ,CAACE,IAAI,CAC3BR,SAAS,CAACS,QAAQ,CAAC,CAAEC,IAAI,CAAEX,cAAc,CAACe,KAAK,CAAEF,OAAO,CAAEL,KAAM,CAAC,CAAC,CAAC,wDACtE,kGAED,iBAAsB,CAClBP,SAAS,CAACS,QAAQ,CAAC,CAAEC,IAAI,CAAEX,cAAc,CAACgB,MAAO,CAAC,CAAC,CACvD,CAAC,0BAED,qBAA6B,CACzB,MAAOf,UAAS,CAACgB,QAAQ,EAAE,CAACT,KAAK,GAAK,IAAI,CAC9C,CAAC,+GAED,kBAAwBU,EAAU,iKACPpB,MAAK,CAACqB,GAAG,CAAYpB,MAAM,CAACO,SAAS,CAAC,aAAa,CAAEY,EAAE,CAAC,QAAzEX,QAAQ,gBACRH,IAAI,CAAGG,QAAQ,CAACE,IAAI,kCACnBL,IAAI,0DACd,0NAGD,wKACUI,KAAK,CAAGP,SAAS,CAACgB,QAAQ,EAAE,CAACT,KAAK,IACpCA,KAAK,2DAAS,CAAC,SAAC,CAAC,uBACMN,UAAS,CAACM,KAAK,CAAC,QAArCY,YAAY,gBACZC,MAAM,CAAGC,OAAO,CAACC,OAAO,CAAEH,YAAY,CAAShB,IAAI,CAACiB,MAAM,CAAC,kCAC1DA,MAAM,0DAChB,yNAED,sLACyB,KAAI,CAACG,kBAAkB,EAAE,QAAxCH,MAAM,qBAETA,MAAM,GAAG,CAAC,4DAAS,KAAK,SACrBjB,IAAI,CAAG,IAAI,CAACqB,UAAU,CAACJ,MAAM,CAAC,wBAChBjB,KAAI,QAAlBsB,IAAI,gBAAgBA,IAAI,MAC3BA,IAAI,GAAG,OAAO,6DAAS,IAAI,2CACvB,KAAK,gEACf,0GAIL,GAAMC,YAAW,CAAG,GAAIxB,YAAW,EAAE,CAErC,cAAewB,YAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}